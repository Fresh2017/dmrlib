import os
import sys

Import('env')

localenv = env.Clone()
localenv.Append(
    LIBS=[
        env['libdmr_name'],
    ],
    LIBPATH=[
        '#build/libdmr',
    ],
)

if env['ENABLE_PROTO_MBE']:
    localenv.Append(
        LIBS=[
            'mbe',
            'portaudio',
        ],
        LIBPATH=[
            '#build/mbelib',
        ],
    )

if sys.platform == 'linux2':
    name = 'noisebridge'
    localenv.Append(
        LIBS=[
            'pthread',
        ],
    )

if sys.platform == 'darwin':
    name = 'noisebridge'
    localenv.Append(
        CPPPATH=[
            '#support/darwin/portaudio/include',
        ],
        LIBS=[
            'pthread',
        ],
        LIBPATH=[
            '#support/darwin/portaudio/lib',
        ],
        LINKFLAGS=[
            '-framework', 'CoreServices',
        ],
    )

if sys.platform == 'win32':
    name = 'noisebridge.exe'

'''
conf = localenv.Configure()
if not conf.CheckLibWithHeader('portaudio', 'portaudio.h', 'c'):
    print('portaudio is required, apt-get install portaudio19-dev')
    Exit(1)
conf.Finish()
'''

noisebridge = localenv.Program(name, Glob('*.c'))
Return('noisebridge')
