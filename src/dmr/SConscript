import os
import sys

Import('env')

localenv = env.Clone()
localenv.Append(
    CPPPATH=[
        os.path.join('#src', 'dmr', 'support', 'tinycthread', 'source'),
    ],
    LIBS=[
        env['libdmrfec_name'],
    ],
    LIBPATH=[
        '#build/libdmrfec',
    ],
    LINKFLAGS=[
        '-static-libgcc',
    ],
)

if sys.platform in ('linux2', 'darwin'):
    env['libdmr_name'] = 'dmr'

elif sys.platform == 'win32':
    env['libdmr_name'] = 'dmr'
    localenv.Append(
        CPPDEFINES=[
            '_CRT_NONSTDC_NO_DEPRECATE',
        ],
        LIBS=[
            'ws2_32',
        ],
    )

src = [
    Glob('*.c'),
    Glob('*/*.c'),
    Glob('support/tinycthread/source/*.c'),
]
dmr = localenv.SharedLibrary(env['libdmr_name'], src)
#env.StaticLibrary(name, src)
Return('dmr')
